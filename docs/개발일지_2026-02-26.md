---
tags: [개발일지, 2026-02]
---

# 2026-02-26 개발 일지

## 1. 작업 요약

- Optimistic UI, FCM 푸시 알림, 공 가져오기("저도 들고가요"), 옵션별 로딩 구현

## 2. 상세 내용

### Optimistic UI (투표/참석)
- **투표**: `poll_detail_page.dart` — `_optimisticVotes`/`_optimisticUnvotes`로 탭 즉시 반영, 실패 시 롤백
- **경기 참석**: `home_page.dart` — `_optimisticVote`로 참석/불참 즉시 반영
- 서버 응답 대기 없이 UI 갱신, `.cursorrules` 규칙 준수

### FCM 푸시 알림 (클라이언트)
- `firebase_messaging` 패키지 추가
- Android: `POST_NOTIFICATIONS` 권한, iOS: `UIBackgroundModes` (remote-notification)
- `FcmService` (fcm_provider.dart): 권한 요청, 토큰 획득/갱신, Firestore 저장 (`members.fcmToken`)
- `FcmInitializer` 위젯, MainShell 진입 시 `syncTokenToFirestore`
- 백그라운드 메시지 핸들러 (`main.dart`)
- Nudge 발송은 Cloud Function 필요 → `docs/FCM_NUDGE_연동가이드.md` 작성

### 공 가져오기 ("저도 들고가요")
- **스키마**: `Match.ballBringers: List<String>?` — 자원자 UID 배열
- **데이터소스**: `toggleBallBringer()` — Firestore `ballBringers` 배열 add/remove
- **UI**: 홈 매치 카드 + 경기 상세에 "공 가져오실 분?" + "저도 들고가요" 칩
- 지정 방식이 아닌 자원 방식 (PRD Tasks 반영)

### 옵션별 로딩 표시
- `poll_detail_page.dart` — `_votingOptionId`로 저장 중인 옵션만 로딩 인디케이터
- 해당 옵션에 16×16 CircularProgressIndicator, 중복 탭 방지

### 파일
- `lib/features/polls/presentation/pages/poll_detail_page.dart`
- `lib/features/matches/presentation/pages/home_page.dart`
- `lib/features/matches/presentation/pages/match_detail_page.dart`
- `lib/features/matches/domain/entities/match.dart`
- `lib/features/matches/data/models/match_model.dart`
- `lib/features/matches/data/datasources/match_remote_data_source.dart`
- `lib/features/notifications/presentation/providers/fcm_provider.dart`
- `lib/app/widgets/fcm_initializer.dart`
- `lib/features/teams/domain/repositories/team_repository.dart`
- `pubspec.yaml`, `AndroidManifest.xml`, `Info.plist`, `main.dart`, `app.dart`
- `docs/FCM_NUDGE_연동가이드.md`, `SCHEMA.md`, `EXPANSION_CHECKLIST.md`

## 3. 트러블 슈팅

- **main.dart import 순서**: `@pragma` 함수 선언 뒤에 import가 있어 "Directives must appear before declarations" 에러 → import를 상단으로 통합

## 4. AI 회고

- Optimistic UI로 투표/참석 UX 개선 효과 큼
- FCM은 클라이언트만 완료, Nudge는 Cloud Function 연동 필요
- 공 가져오기는 자원 방식으로 PRD 의도에 맞게 구현

## 5. 내일 할 일

- 지각 시간 선택 (PRD 필수)
- Nudge Cloud Function 배포
- 20일 등록 공지 초안 (Draft & Approve)
