# í…”ë ˆê·¸ë¨ ê°€ì… ìŠ¹ì¸ ì„¤ì • ê°€ì´ë“œ

ì–´ë“œë¯¼ ì›¹ ì—†ì´ **í…”ë ˆê·¸ë¨**ì—ì„œ íŒ€ ê°€ì… ì‹ ì²­ì„ ìŠ¹ì¸/ê±°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ë™ì‘ íë¦„

1. ì‚¬ìš©ìê°€ ì•±ì—ì„œ íŒ€ ê°€ì… ì‹ ì²­ â†’ Firestore `members`ì— `status: pending` ì €ì¥
2. Cloud Function `onMemberJoinRequest` íŠ¸ë¦¬ê±° â†’ ê´€ë¦¬ì í…”ë ˆê·¸ë¨ìœ¼ë¡œ ì•Œë¦¼ ë°œì†¡ (ìŠ¹ì¸/ê±°ì ˆ ë²„íŠ¼ í¬í•¨)
3. ê´€ë¦¬ìê°€ í…”ë ˆê·¸ë¨ì—ì„œ ë²„íŠ¼ í´ë¦­ â†’ `telegramWebhook` í˜¸ì¶œ â†’ Firestore `status` ì—…ë°ì´íŠ¸

---

## 1. Telegram Bot ìƒì„±

1. [@BotFather](https://t.me/BotFather)ì—ì„œ `/newbot` ì‹¤í–‰
2. ë´‡ ì´ë¦„ ì…ë ¥ í›„ **Bot Token** ë³µì‚¬ (ì˜ˆ: `123456789:ABCdefGHI...`)

---

## 2. Admin Chat ID í™•ì¸

ìŠ¹ì¸ ì•Œë¦¼ì„ ë°›ì„ ì±„íŒ…ë°©(ë˜ëŠ” ë³¸ì¸ DM)ì˜ Chat IDê°€ í•„ìš”í•©ë‹ˆë‹¤.

**ë°©ë²• A: @userinfobot ì‚¬ìš©**
- ë³¸ì¸ì—ê²Œ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ê²½ìš°: [@userinfobot](https://t.me/userinfobot)ì— `/start` â†’ í‘œì‹œë˜ëŠ” `Id`ê°€ Chat ID
- ê·¸ë£¹ì˜ ê²½ìš°: ë´‡ì„ ê·¸ë£¹ì— ì¶”ê°€í•œ ë’¤, ê·¸ë£¹ì—ì„œ ì•„ë¬´ ë©”ì‹œì§€ ë³´ë‚´ê¸° â†’ [@userinfobot](https://t.me/userinfobot)ì´ ê·¸ë£¹ ID í‘œì‹œ (ìŒìˆ˜, ì˜ˆ: `-1001234567890`)

**ë°©ë²• B: getUpdates API**
- ë´‡ì—ê²Œ `/start` ë˜ëŠ” ì•„ë¬´ ë©”ì‹œì§€ ë³´ë‚´ê¸°
- ë¸Œë¼ìš°ì €ì—ì„œ `https://api.telegram.org/bot<TOKEN>/getUpdates` ì ‘ì†
- ì‘ë‹µ JSONì˜ `message.chat.id` ê°’ì´ Chat ID

---

## 3. Firebase Functions ì„¤ì •

```bash
# í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ
firebase functions:config:set telegram.bot_token="YOUR_BOT_TOKEN" telegram.admin_chat_id="YOUR_CHAT_ID"
```

ì˜ˆì‹œ:
```bash
firebase functions:config:set telegram.bot_token="123456789:ABCdefGHI..." telegram.admin_chat_id="-1001234567890"
```

---

## 4. Functions ë°°í¬

```bash
firebase deploy --only functions
```

ë°°í¬ í›„ **telegramWebhook** í•¨ìˆ˜ URLì„ í™•ì¸í•©ë‹ˆë‹¤:
```
https://<region>-<project>.cloudfunctions.net/telegramWebhook
```

---

## 5. Telegram Webhook ë“±ë¡

ë°°í¬ëœ URLì„ Telegramì— ë“±ë¡í•©ë‹ˆë‹¤:

```bash
curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook?url=https://<region>-<project>.cloudfunctions.net/telegramWebhook"
```

ì˜ˆì‹œ:
```bash
curl "https://api.telegram.org/bot123456789:ABCdef.../setWebhook?url=https://asia-northeast3-myproject.cloudfunctions.net/telegramWebhook"
```

ì„±ê³µ ì‹œ `{"ok":true,"result":true,...}` ì‘ë‹µì´ ì˜µë‹ˆë‹¤.

---

## 6. í™•ì¸

1. ì•±ì—ì„œ íŒ€ ê°€ì… ì‹ ì²­
2. ì„¤ì •í•œ Chat ID ì±„íŒ…ë°©ì— "ğŸ†• ì‹ ê·œ ê°€ì… ì‹ ì²­" ë©”ì‹œì§€ê°€ ì˜¤ëŠ”ì§€ í™•ì¸
3. âœ… ìŠ¹ì¸ / âŒ ê±°ì ˆ ë²„íŠ¼ í´ë¦­ â†’ Firestore `status`ê°€ `active` ë˜ëŠ” `rejected`ë¡œ ë³€ê²½ë˜ëŠ”ì§€ í™•ì¸

---

## ì£¼ì˜ì‚¬í•­

- **ë‹¨ì¼ ê´€ë¦¬ì**: í˜„ì¬ëŠ” í•˜ë‚˜ì˜ `admin_chat_id`ë¡œë§Œ ë°œì†¡ë©ë‹ˆë‹¤. íŒ€ë³„ë¡œ ë‹¤ë¥¸ ì±„íŒ…ë°©ì— ë³´ë‚´ë ¤ë©´ ì¶”ê°€ ê°œë°œì´ í•„ìš”í•©ë‹ˆë‹¤.
- **callback_data 64ë°”ì´íŠ¸ ì œí•œ**: teamId + userIdê°€ ë„ˆë¬´ ê¸¸ë©´ ì•Œë¦¼ì€ ê°€ì§€ë§Œ ë²„íŠ¼ì´ ë™ì‘í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŒ€/ìœ ì € IDë¥¼ ì§§ê²Œ ìœ ì§€í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
- **config ë³€ê²½ ì‹œ**: `firebase functions:config:set` í›„ `firebase deploy --only functions`ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.
