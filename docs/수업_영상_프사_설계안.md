# 수업 스케줄 · 영상 · 프로필 사진 설계안

> 2026-02-24 기준

---

## 1. 수업 스케줄 유연성 (매주 목요일 + 예외)

### 현재 흐름
- **일자별 참석 투표**: 해당 월 **기존 수업(Event)** 일정을 옵션으로 사용
- 문제: 수업이 없으면 투표 생성 불가 → **수업 일정을 먼저 만들어야 함**

### 제안: "월별 수업 일정 자동 생성" 도구

**입력**
- 대상 월 (yyyy-MM)
- 기본 요일: 목요일 (설정 가능)
- 옵션:
  - ☑️ 공휴일 제외 (한국 공휴일 API 또는 로컬 목록)
  - ☑️ 5번째 주 포함 (체크 시 5번째 목요일 포함, 미체크 시 제외)

**처리**
1. 해당 월의 모든 목요일 계산
2. 공휴일 제외 (선택 시)
3. 5번째 목요일 포함/제외 (옵션)
4. 결과 목록 표시 → 사용자가 일부 삭제/추가 가능
5. "수업 일정 생성" 클릭 → `createClassesBatch` 호출

**구현 위치**
- `lib/features/events/domain/services/class_schedule_generator.dart` (신규)
- `lib/features/schedule/presentation/widgets/class_schedule_create_sheet.dart` (신규)
- 일정 탭 또는 투표 생성 페이지에 "이번 달 수업 일정 생성" 진입점

**공휴일 처리**
- `lib/core/utils/korean_holidays.dart` - 2025~2026 한국 공휴일 하드코딩 (또는 외부 API)
- 또는 초기에는 공휴일 제외 없이 제공, 추후 확장

---

## 2. 프로필 사진 (프사)

### 현재 상태
- ✅ **이미 구현됨**: `ProfilePhotoUploader` + `uploadImageProvider.memberProfile` + `teamRepo.updateMemberPhotoUrl`
- Storage 연동, MY 페이지 프로필 카드에서 사용 중

### 확인 사항
- `StorageRemoteDataSource`, `UploadImage` UseCase가 제대로 연동되어 있는지 확인
- `firebase_storage` 패키지 설정 확인

---

## 3. 경기 영상 (YouTube 링크 + 플레이리스트)

### 요구사항
- ❌ 영상 파일 직접 저장/아카이빙 X (부담)
- ✅ YouTube 링크만 저장
- ✅ 플레이리스트 링크 → 바로 재생 가능
- ✅ **타임스탬프(좌표) + 댓글**: 특정 시점에 댓글 달기 (예: "12:34 - 이 골 멋짐")

### 스키마 변경 제안

**`teams/{teamId}/match_media/{mediaId}`**
| 필드 | 타입 | 설명 |
|------|------|------|
| matchId | String | 연결된 경기 ID |
| opponentTeamName | String | 상대팀명 |
| playlistUrl | String | YouTube 플레이리스트 URL (우선) |
| videoUrls | Array<String> | 개별 YouTube 영상 URL (선택) |
| timestampComments | Array | `{ timestamp: "12:34", userId, userName, text, createdAt }` |
| uploadedBy | String | 등록자 UID |
| createdAt | Timestamp | |

**timestampComments**
- `timestamp`: "12:34" (분:초) → YouTube URL에 `&t=754` (초) 추가 시 해당 시점으로 이동
- `text`: 댓글 내용
- `userId`, `userName`: 작성자

### UI 흐름
1. 경기 상세 또는 별도 "경기 영상" 메뉴
2. "플레이리스트 링크 추가" → YouTube 플레이리스트 URL 입력
3. 링크 탭 시 `url_launcher`로 YouTube 앱/웹에서 바로 재생
4. "타임스탬프 댓글" 섹션: 시점(12:34) + 댓글 입력 → 저장
5. 댓글 탭 시 해당 시점 YouTube URL로 이동 (예: `https://youtube.com/watch?v=xxx&t=754`)

### 구현 위치
- `lib/features/match_media/` - 엔티티에 `timestampComments` 추가
- `lib/features/match_media/presentation/` - 영상 등록/상세 페이지 (신규 또는 경기 상세 내 탭)
- `url_launcher` 패키지로 YouTube 링크 오픈

---

## 4. 구현 우선순위

| 순서 | 항목 | 난이도 | 비고 |
|------|------|--------|------|
| 1 | 월별 수업 일정 자동 생성 | 중 | 목요일 계산, 공휴일(선택), 5번째 주 옵션 |
| 2 | 경기 영상: 플레이리스트 URL + 바로 재생 | 하 | 기존 match_media 활용, url_launcher |
| 3 | 타임스탬프 댓글 | 중 | 스키마 확장, UI |
| 4 | 프로필 사진 | - | 이미 구현됨, 동작 확인만 |

---

## 5. 다음 단계

1. **수업 일정 생성기** 구현 → Poll 생성 시 "목요일 자동 생성" 옵션 추가
2. **match_media** UI 구현 (플레이리스트 URL 입력, 링크로 재생)
3. **timestampComments** 스키마 + UI
